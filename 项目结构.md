# egui_basic_standalone 项目结构说明

本文件描述了 `egui_basic_standalone` 项目的主要目录和文件结构。

## 1. 根目录 (`egui_basic_standalone/`)

根目录包含项目配置文件、版本控制信息、文档以及编译输出目录。

*   **`Cargo.toml`**:
    *   Rust 项目的清单文件，由 Cargo（Rust 的构建系统和包管理器）使用。
    *   定义了项目的元数据，如名称 (`egui_basic_standalone`)、版本、作者、Rust Edition (`2021`) 等。
    *   声明了项目依赖项（dependencies），例如 `egui_graphs`, `egui`, `eframe`, `petgraph`, `fdg`, `rand`, `crossbeam-channel` 等，并指定了它们的版本和特性。
    *   还可能包含特定平台的依赖（如 `winapi` 用于 Windows）。

*   **`Cargo.lock`**:
    *   由 Cargo 自动生成和维护的文件，用于确保构建的可复现性。
    *   它精确记录了项目中所有直接和间接依赖项的具体版本号和来源。
    *   通常不应手动编辑此文件，但应将其提交到版本控制系统中。

*   **`.gitignore`**:
    *   Git 版本控制系统的配置文件，用于指定哪些文件或目录应该被 Git 忽略，不纳入版本控制。
    *   对于 Rust 项目，通常会忽略 `target/` 目录（包含编译产物）、某些 IDE 配置文件、日志文件等。

*   **`src/` (目录)**:
    *   存放项目所有 Rust 源代码的主要目录。详见下一节。

*   **`target/` (目录)**:
    *   Cargo 用于存放所有编译输出（如可执行文件、库文件、构建脚本输出、增量编译缓存等）的目录。
    *   此目录通常体积较大，并且其内容是根据源代码和 `Cargo.toml` 配置自动生成的，因此一般会被添加到 `.gitignore` 中，不纳入版本控制。

*   **`项目修改回顾.md`**:
    *   用户创建的 Markdown 文档，用于记录项目从早期阶段开始的修改和演进过程。
    *   对理解项目的开发历史和关键决策非常有帮助。

*   **`大作业报告.md`**:
    *   （由AI生成的）项目的大作业报告文档，详细描述了项目的背景、目标、技术选型、实现过程、遇到的挑战和总结。

## 2. `src/` 目录 (重构后)

为了提高代码的可维护性和模块化，`src/` 目录下的代码已被重构为多个文件：

*   **`main.rs`**:
    *   作为程序的唯一入口点。
    *   包含 `main()` 函数，负责初始化并运行 `eframe` 应用。
    *   声明了其他模块 (`app`, `settings_panel`, `graph_view`)。

*   **`app.rs`**:
    *   定义了核心应用逻辑。
    *   包含 `BasicApp` 结构体定义，持有应用的所有状态数据（如图数据、模拟器状态、UI配置项、输入字段状态等）。
    *   包含 `impl BasicApp`，实现了应用的主要方法，如：
        *   构造与初始化: `new()`, `reset_graph_and_simulation()`, `populate_graph_data()`, `initialize_egui_node_positions()`
        *   图结构与类型操作: `convert_graph_direction()`, `add_node_ui()`, `add_edge_ui()`, `remove_node_ui()`, `add_edge_between_selected_nodes()`, `remove_selected_edges_ui()`
        *   Payload 访问与更新: `get_node_payload_mut()`, `get_edge_payload_mut()`, `update_fdg_node_payload()`, `update_fdg_edge_payload()`
        *   模拟与同步: `update_simulation()`, `sync_node_positions_to_egui()`, `sync_egui_positions_to_fdg()`
        *   事件处理: `handle_events()`
    *   包含 `impl eframe::App for BasicApp`，其 `update()` 方法现在委托给 `settings_panel.rs` 和 `graph_view.rs` 中的函数来绘制UI。
    *   定义了核心数据结构如 `NodePayload { label, weight }`, `EdgePayload { label, weight }`, 和 `AppGraph` 枚举。
    *   定义了常量如 `DEFAULT_NODE_COUNT`, `DEFAULT_EDGE_COUNT`。

*   **`settings_panel.rs`**:
    *   负责绘制应用程序的右侧配置面板。
    *   包含 `draw_settings_panel()` 主函数，以及多个辅助函数来组织UI的各个部分，例如：
        *   `draw_graph_properties_settings` (图属性：有向/无向切换，节点/边数量，重置图)
        *   `draw_style_settings` (样式：标签显示)
        *   `draw_navigation_settings` (导航：适应屏幕，缩放平移)
        *   `draw_interaction_settings` (交互：节点/边拖拽、点击、选择)
        *   `draw_simulation_settings` (模拟：停止/启动，参数调整)
        *   `draw_node_edge_management` (节点/边管理：通过标签添加/删除节点/边，通过选择添加/删除边，权重输入)
        *   `draw_selected_element_properties` (显示和编辑选中单个节点/边的权重)
        *   `draw_debug_info` (显示图和选择状态的调试信息)

*   **`graph_view.rs`**:
    *   负责在中央面板中绘制和显示交互式图。
    *   包含 `draw_graph_view()` 函数，该函数根据 `BasicApp` 的状态配置并渲染 `egui_graphs::GraphView` 小部件，包括样式、导航和交互设置。

这种新的结构将UI渲染逻辑与核心应用状态和逻辑更清晰地分离开来，提高了代码的组织性和可维护性。

## 3. 未来可能的改进

*   **`assets/` (目录)**: 如果项目需要加载外部资源，如自定义图标、配置文件等。
*   **`tests/` (目录)**: 用于存放集成测试。
*   **错误处理**: 更完善的错误处理和用户反馈机制。
*   **配置持久化**: 保存和加载用户对图的配置和图本身的状态。
## 2.1. `src/` 目录 (重构后)

为了提高代码的可维护性和模块化，`src/` 目录下的代码已被重构为多个文件：

*   **`main.rs`**:
    *   现在作为程序的唯一入口点。
    *   包含 `main()` 函数，负责初始化并运行 `eframe` 应用。
    *   声明了其他模块 (`app`, `settings_panel`, `graph_view`)。

*   **`app.rs`**:
    *   定义了核心应用逻辑。
    *   包含 `BasicApp` 结构体定义，持有应用的所有状态数据。
    *   包含 `impl BasicApp`，实现了应用的主要方法，如 `new()` (构造函数)、图数据管理 (`reset_graph_and_simulation`, `convert_graph_direction`, `populate_graph_data`, `add_node_ui`, `add_edge_ui`, `remove_node_ui`, `remove_selected_edges_ui` 等)、模拟逻辑 (`update_simulation`, `sync_node_positions_to_egui`, `sync_egui_positions_to_fdg`) 和事件处理 (`handle_events`)。
    *   包含 `impl eframe::App for BasicApp`，其 `update()` 方法现在委托给 `settings_panel.rs` 和 `graph_view.rs` 中的函数来绘制UI。
    *   定义了核心数据结构如 `NodePayload`, `EdgePayload`, 和 `AppGraph`。

*   **`settings_panel.rs`**:
    *   负责绘制应用程序的右侧配置面板。
    *   包含 `draw_settings_panel()` 函数，该函数接收 `BasicApp` 的可变引用和 `egui::Context`。
    *   UI逻辑被细分为多个内部函数，如 `draw_graph_properties_settings`, `draw_style_settings`, `draw_navigation_settings`, `draw_interaction_settings`, `draw_simulation_settings`, `draw_node_edge_management`, `draw_selected_element_properties` 和 `draw_debug_info`。

*   **`graph_view.rs`**:
    *   负责在中央面板中绘制和显示交互式图。
    *   包含 `draw_graph_view()` 函数，该函数接收 `BasicApp` 的可变引用、`egui::Context` 和 `eframe::Frame`。
    *   在此函数内部，根据 `BasicApp` 的状态配置并渲染 `egui_graphs::GraphView` 小部件。

这种新的结构将UI渲染逻辑（设置面板和图视图）与核心应用状态和逻辑分离开来，使得代码更易于理解和维护。